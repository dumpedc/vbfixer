# Проблема
vBulletin версии 3.8.4 некорректно работает с интерпретатором php 5.3 и выше. В error_log попадает бесчетное количество бессмысленных deprecated warning'ов, что заставляет его моментально разрастаться.

# Решение
Данный скрипт позволяет в автоматическом режиме исправить некоторые проблемы vBulletin 3.8.4, проанализировав все входящие в дистрибутив php файлы и сделав автозамену устранить их. Пока что поддерживается только решение **Assigning the return value of new by reference is deprecated**.

Использование скрипта осуществляется исключительно на свой страх и риск, решение пока что не обкатывалось на реальных проектах и носит сугубо академический характер. На данный момент цель выявить корректность автозамен и доработать решение для возможности применения на работающих проектах.

# Установка
Для работы скрипта необходим интерпретатор python версии 2.7. Вероятно он так же будет работать на третьей ветке, либо при минимальных правках, однако работа в третьей ветке не тестировалась.

Перед началом работы потребуется установить пакеты с зависимостями. Сделать это проще простого, поможет команда `pip install -r requirements.txt`

Сделать это можно либо под рутом, установив пакеты в основную систему (Не очень хорошее решение), либо используя [virtualenv](http://docs.python-guide.org/en/latest/dev/virtualenvs/).

# Использование
```
Usage: python vbfixer.py [OPTIONS] PATH

Options:
  -v                        Расширенный вывод
  -c TEXT                   Кодировка файлов. Если не указана, будет
                            определена через libmagic
  -s                        "Тихий" режим. Все замены будут произведены
                            автоматически. В каталогах будут созданы patch-
                            файлы с аналогичными именами
  -i [assign_by_reference]  Включает только конкретные проверки из заданного
                            списка
  --help                    Show this message and exit.
```
По умолчанию скрипт запускается в интерактивном режиме, запрашивая подтверждение на каждое изменение. 

Ключ `-s` включает "тихий" режим, производящий автоматические замены, но при этом оставляя рядом unix patch-файлы с описанием проделанных изменений, что позволяет быстро откатить нежелательные.

`PATH` может быть как конкретным файлом (Например `python vbfixer.py /tmp/vbulletin/includes/init.php`), так и каталогом (Например `python vbfixer.py /tmp/vbulletin`). 

В случае каталога скрипт будет осуществлять рекурсивный поиск во всех файлах с расширением `.php` внутри каталога.

# На будещее 
Необходимо искать проблемы не только в файлах, но и в базе данных mysql, где хранится код модулей. Модули зачастую так же используют устаревшие функции, что не позволяет окончательно избавиться от надоедливых ошибок в error_log. 

Необходимо парсить config.php проекта, находить там параметры для подключения к mysql и подключаться с этими параметрами к базе данных для дальнейшего анализа.
